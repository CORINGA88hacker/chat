<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Admin Moderno</title>

<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f7f9fc;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    min-height: 100vh;
    align-items: flex-start;
  }

  #painelAdmin {
    background: white;
    margin: 20px;
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
    max-width: 600px;
    width: 100%;
  }

  #painelAdmin h2 {
    font-weight: 700;
    font-size: 28px;
    margin-bottom: 24px;
    color: #2c3e50;
    border-bottom: 2px solid #1abc9c;
    padding-bottom: 10px;
  }

  h3 {
    color: #34495e;
    margin-bottom: 12px;
    font-weight: 600;
    border-bottom: 1px solid #d1d9e6;
    padding-bottom: 8px;
  }

  input[type="file"] {
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    cursor: pointer;
    width: 100%;
    margin-bottom: 12px;
  }

  #btnUploadFoto {
    background-color: #1abc9c;
    border: none;
    color: white;
    padding: 12px 18px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
    margin-bottom: 20px;
  }

  #btnUploadFoto:hover {
    background-color: #16a085;
  }

  #msgUpload {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 20px;
    min-height: 18px;
  }

  #listaUsuariosAdmin {
    max-height: 380px;
    overflow-y: auto;
    border: 1px solid #d1d9e6;
    border-radius: 10px;
    padding: 12px;
    background-color: #fafafa;
  }

  #listaUsuariosAdmin > div {
    display: flex;
    align-items: center;
    border-bottom: 1px solid #e0e6f2;
    padding: 12px 0;
    gap: 12px;
  }

  #listaUsuariosAdmin > div:last-child {
    border-bottom: none;
  }

  #listaUsuariosAdmin > div.banido {
    background: #ffe6e6;
  }

  img {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
  }

  .infoUsuario {
    flex-grow: 1;
    font-weight: 600;
    color: #34495e;
    user-select: text;
  }

  .statusBanido {
    font-weight: 700;
    color: #c0392b;
  }

  .statusAtivo {
    font-weight: 700;
    color: #27ae60;
  }

  input[type="number"] {
    width: 110px;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

  button.banirBtn, button.desbanirBtn {
    padding: 8px 16px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin-left: 8px;
    font-size: 14px;
    user-select: none;
  }

  button.banirBtn {
    background-color: #e74c3c;
    color: white;
  }
  button.banirBtn:hover {
    background-color: #c0392b;
  }

  button.desbanirBtn {
    background-color: #2ecc71;
    color: white;
  }
  button.desbanirBtn:hover {
    background-color: #27ae60;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

</head>
<body>

<div id="painelAdmin">
  <h2>Painel Admin Moderno (Sem Login)</h2>

  <h3>Enviar Foto de Perfil</h3>
  <input type="file" id="uploadFoto" />
  <button id="btnUploadFoto">Enviar Foto</button>
  <p id="msgUpload"></p>

  <h3>Gerenciar Usuários</h3>
  <div id="listaUsuariosAdmin">Carregando usuários...</div>
</div>

<script>
  // Seu firebaseConfig
  const firebaseConfig = {
    apiKey: "AIzaSyBHIc2E4XwRO5FXo4uHlTQVRArOis73MjE",
    authDomain: "projeto-deus-yato-928-sk.firebaseapp.com",
    databaseURL: "https://projeto-deus-yato-928-sk-default-rtdb.firebaseio.com",
    projectId: "projeto-deus-yato-928-sk",
    storageBucket: "projeto-deus-yato-928-sk.appspot.com",
    messagingSenderId: "790408726854",
    appId: "1:790408726854:android:e2f0de7b7d5dba96b0fd47"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  const listaUsuariosAdmin = document.getElementById("listaUsuariosAdmin");
  const btnUploadFoto = document.getElementById("btnUploadFoto");
  const uploadFotoInput = document.getElementById("uploadFoto");
  const msgUpload = document.getElementById("msgUpload");

  async function carregarUsuariosAdmin() {
    listaUsuariosAdmin.innerHTML = "Carregando usuários...";
    const snapshot = await db.ref("usuarios").once("value");
    const usuarios = snapshot.val();
    if (!usuarios) {
      listaUsuariosAdmin.innerHTML = "Nenhum usuário cadastrado.";
      return;
    }
    listaUsuariosAdmin.innerHTML = "";

    for (const uid in usuarios) {
      const userData = usuarios[uid];
      const banSnap = await db.ref("banidos/" + uid).once("value");
      const banData = banSnap.val();
      const agora = Date.now();
      const banido = banData && banData.banido_ate > agora;

      const div = document.createElement("div");
      div.className = banido ? "banido" : "";
      div.innerHTML = `
        <img src="${userData.fotoPerfil}" alt="${userData.nome}" />
        <div class="infoUsuario">
          ${userData.nome} <br/>
          <small>UID: ${uid}</small><br/>
          Status: <span class="${banido ? "statusBanido" : "statusAtivo"}">${banido ? "Banido até " + new Date(banData.banido_ate).toLocaleString() : "Ativo"}</span>
        </div>
        <input type="number" min="1" placeholder="Minutos ban" id="banTempo_${uid}" />
        <button class="banirBtn" onclick="banirUsuario('${uid}')">Banir</button>
        <button class="desbanirBtn" onclick="desbanirUsuario('${uid}')">Desbanir</button>
      `;
      listaUsuariosAdmin.appendChild(div);
    }
  }

  window.banirUsuario = async (uid) => {
    const input = document.getElementById("banTempo_" + uid);
    const minutos = parseInt(input.value);
    if (!minutos || minutos <= 0) {
      alert("Digite um tempo válido em minutos.");
      return;
    }
    const banido_ate = Date.now() + minutos * 60000;
    await db.ref("banidos/" + uid).set({ banido_ate });
    alert("Usuário banido por " + minutos + " minutos.");
    carregarUsuariosAdmin();
  };

  window.desbanirUsuario = async (uid) => {
    await db.ref("banidos/" + uid).remove();
    alert("Usuário desbanido.");
    carregarUsuariosAdmin();
  };

  btnUploadFoto.onclick = () => {
    const file = uploadFotoInput.files[0];
    if (!file) {
      alert("Selecione um arquivo para enviar!");
      return;
    }
    const ref = storage.ref("fotosPerfil/" + file.name);
    const uploadTask = ref.put(file);

    uploadTask.on("state_changed",
      null,
      error => {
        msgUpload.style.color = "red";
        msgUpload.textContent = "Erro no upload: " + error.message;
      },
      () => {
        uploadTask.snapshot.ref.getDownloadURL().then(url => {
          db.ref("fotosPerfil").push(url);
          msgUpload.style.color = "green";
          msgUpload.textContent = "Foto enviada com sucesso!";
          uploadFotoInput.value = "";
          carregarUsuariosAdmin();
        });
      });
  };

  carregarUsuariosAdmin();
</script>

</body>
</html>
